const storeKey='dm_p0_plus_log';export class Logbook{constructor(viewEl){this.viewEl=viewEl;try{this.logs=JSON.parse(localStorage.getItem(storeKey)||'[]')}catch{this.logs=[]}this.render()}add(entry){const row={t:new Date().toISOString(),...entry};this.logs.push(row);if(this.logs.length>500)this.logs.shift();localStorage.setItem(storeKey,JSON.stringify(this.logs));this.render()}render(){if(!this.viewEl)return;this.viewEl.textContent=this.logs.map(x=>`[${x.t}] ${x.level||'info'} ${x.cat||''} ${x.msg||''}`).join('\n')}download(){const blob=new Blob([JSON.stringify(this.logs,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='dm_p0_plus_incidents.json';a.click();setTimeout(()=>URL.revokeObjectURL(url),1e3)}}