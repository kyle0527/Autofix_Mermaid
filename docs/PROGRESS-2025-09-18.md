Progress Report — 2025-09-18
=============================

Overview
--------
This document summarises the recent work done on the AutoFix_Mermaid project and the current state as of 2025-09-18.

Completed items
---------------
- Audit and feasibility analysis: evaluated whether the project can support a full UI-driven pipeline (upload folder -> analyze -> generate Mermaid -> render -> export).
- End-to-end contract: defined inputs, outputs, error modes, and success criteria for an initial PoC.
- Basic IR and utilities:
  - `js/engine/ir.js` — provides createIR, addEntity, addRelation, findEntity, toMermaidClassDiagram.
  - `js/engine/common.js` — export guessDiagramType and utilities.
- Rules and validation:
  - `worker.rules-loader.stub.js` — loader that fetches rulepack/promptpack and integrates validation.
  - `js/engine/rules-validator.js` — lightweight validator used by loader and CI.
- CI/validation guidance:
  - Created `scripts/validate_packs.mjs` (in repo) and suggested CI step to validate `rules/` when present.
- Tests added:
  - Unit tests for `guessDiagramType` and IR (under `test/unit/`).

Files inspected/modified
------------------------
- `index.html` (UI controls & elements)
- `js/engine/common.js` (diagram detection utilities)
- `js/engine/ir.js` (IR basic APIs)
- `worker.rules-loader.stub.js` (loader + sanitizer)
- `js/engine/rules-validator.js` (light validator)
- `package.json` (test scripts updated)
- `test/unit/*` (unit tests added)

Outstanding tasks
-----------------
- Replace lightweight validator with AJV schema-based validation.
- Generate official `rules/rulepack.json` and `rules/promptpack.json` from knowledge pack (Excel) and commit or make them CI artifacts.
- Implement PoC analyzer to scan JS/TS files and produce `classDiagram` via IR.
- UI wiring: connect analyzer, IR -> Mermaid generation, preview, and export buttons.

Next steps (recommendation)
--------------------------
1. Implement PoC (JS-only): `js/engine/analyzer.js` using `acorn` to parse JS/TS and populate IR; create UI handler in `autofix.js` to trigger analysis and rendering.
2. Add AJV-based validator and replace `rules-validator.js`.
3. Optionally implement Tree-sitter (WASM) for multi-language parsing.

Contact
-------
If you want me to start implementing the PoC now, reply with 'Start PoC (JS-only)'.
